<div class="container py-5">
  <div class="row justify-content-center">
    <div class="col-lg-6">
      <div class="card shadow-lg">
        <div class="card-header bg-success text-white text-center">
          <h2 class="mb-0">
            <i class="bi bi-check-circle"></i>
            Share Link Created!
          </h2>
        </div>

        <div class="card-body text-center">
          <!-- Dog Info -->
          <div class="mb-4">
            <h3 class="mb-1"><%= @dog.name %>'s Profile</h3>
            <p class="text-muted"><%= @dog.breed %></p>
          </div>

          <!-- QR Code -->
          <div class="p-4 bg-light rounded mb-4">
            <%= @qr_code.html_safe %>
          </div>

          <!-- Status Info -->
          <div class="row g-3 mb-4">
            <div class="col-6">
              <div class="card bg-light">
                <div class="card-body">
                  <h6 class="card-subtitle mb-2 text-muted">Status</h6>
                  <span class="badge <%= @shareable_profile.active? ? 'bg-success' : 'bg-danger' %> fs-6">
                    <i class="bi bi-<%= @shareable_profile.active? ? 'check-circle' : 'x-circle' %>"></i>
                    <%= @shareable_profile.active? ? 'Active' : 'Expired' %>
                  </span>
                </div>
              </div>
            </div>

            <div class="col-6">
              <div class="card bg-light">
                <div class="card-body">
                  <h6 class="card-subtitle mb-2 text-muted">Views</h6>
                  <p class="mb-0 fs-5 fw-bold">
                    <%= @shareable_profile.view_count %>
                    <% if @shareable_profile.max_views %>
                      <span class="text-muted">/ <%= @shareable_profile.max_views %></span>
                    <% end %>
                  </p>
                </div>
              </div>
            </div>
          </div>

          <!-- Additional Info -->
          <div class="alert alert-info">
            <div class="row">
              <div class="col-12 mb-2">
                <i class="bi bi-calendar-event"></i>
                <strong>Expires:</strong>
                <%= @shareable_profile.expires_at.strftime("%B %d, %Y at %I:%M %p") %>
              </div>

              <% if @shareable_profile.access_pin_digest.present? %>
                <div class="col-12">
                  <i class="bi bi-lock-fill"></i>
                  <span class="badge bg-warning text-dark">PIN Protected</span>
                </div>
              <% end %>
            </div>
          </div>

          <!-- Share URL -->
          <div class="input-group mb-4">
            <input type="text"
                   class="form-control"
                   value="<%= @share_url %>"
                   readonly
                   id="share-url-input">
            <button class="btn btn-outline-secondary" type="button" onclick="copyURL()">
              <i class="bi bi-clipboard"></i> Copy
            </button>
          </div>

          <!-- Share Buttons -->
          <%= link_to "https://wa.me/?text=#{CGI.escape(@share_url)}",
                        class: "btn btn-success btn-lg",
                        target: "_blank" do %>
              <i class="bi bi-whatsapp"></i> Share via WhatsApp
            <% end %>

            <%= link_to @share_url,
                        class: "btn btn-primary btn-lg",
                        target: "_blank" do %>
              <i class="bi bi-box-arrow-up-right"></i> Open Profile
            <% end %>
          </div>
        </div>

        <!-- Footer Actions -->
        <div class="card-footer bg-light">
          <div class="d-flex justify-content-between align-items-center flex-wrap gap-2">
            <%= link_to analytics_dog_shareable_profile_path(@dog, @shareable_profile),
                        class: "btn btn-sm btn-outline-info" do %>
              <i class="bi bi-graph-up"></i> Analytics
            <% end %>

            <%= link_to dog_path(@dog),
                        class: "btn btn-sm btn-outline-secondary" do %>
              <i class="bi bi-arrow-left"></i> Back to <%= @dog.name %>
            <% end %>

            <%= button_to dog_shareable_profile_path(@dog, @shareable_profile),
                          method: :delete,
                          data: {
                            turbo_confirm: "Are you sure you want to delete this share link?"
                          },
                          class: "btn btn-sm btn-outline-danger" do %>
              <i class="bi bi-trash"></i> Delete Link
            <% end %>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
function copyURL() {
  const input = document.getElementById('share-url-input');
  input.select();
  input.setSelectionRange(0, 99999);

  navigator.clipboard.writeText(input.value).then(() => {
    const button = event.target.closest('button');
    const originalHTML = button.innerHTML;
    button.innerHTML = '<i class="bi bi-check"></i> Copied!';
    button.classList.remove('btn-outline-secondary');
    button.classList.add('btn-success');

    setTimeout(() => {
      button.innerHTML = originalHTML;
      button.classList.remove('btn-success');
      button.classList.add('btn-outline-secondary');
    }, 2000);
  });
}
</script>
