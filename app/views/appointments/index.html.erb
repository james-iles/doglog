<div class="container py-4">
  <%= link_to dog_path(@dog), class: "text-decoration-none mb-3 d-inline-block" do %>
    <i class="fa-solid fa-arrow-left me-1"></i> Back to <%= @dog.name %>
  <% end %>

  <div class="d-flex justify-content-between align-items-center mb-4">
    <div>
      <h1 class="mb-1">Appointments</h1>
      <p class="text-muted mb-0"><%= @appointments.count %> total appointments</p>
    </div>
    <%= link_to new_dog_appointment_path,
            class: "btn btn-sm btn-primary",
            title: "New appointment" do %>
    <i class="fa-solid fa-plus"></i>
    <% end %>
  </div>

  <% if @appointments.any? %>
    <div class="row">
      <% @appointments.order(start_time: :asc).each do |appointment| %>
        <div class="col-md-6 col-lg-4 mb-3">
          <div class="card h-100 shadow-sm position-relative">
            <!-- Action buttons in top right corner -->
            <div class="position-absolute top-0 end-0 p-2" style="z-index: 10;">
              <%= link_to appointment_path(appointment),
                      class: "btn btn-sm btn-primary",
                      title: "View appointment" do %>
                <i class="fa-regular fa-eye"></i>
              <% end %>

              <%= link_to edit_appointment_path(appointment),
                      class: "btn btn-sm btn-warning",
                      title: "Edit appointment" do %>
                <i class="fa-regular fa-pen-to-square"></i>
              <% end %>

              <%= link_to appointment_path(appointment),
                      data: { turbo_method: :delete, turbo_confirm: "Are you sure?" },
                      class: "btn btn-sm btn-danger",
                      title: "Delete appointment" do %>
                <i class="fa-regular fa-trash-can"></i>
              <% end %>
            </div>

            <div class="card-body">
              <!-- Title -->
              <h5 class="card-title mb-3" style="padding-right: 100px;">
                <%= appointment.title.present? ? appointment.title : "#{appointment.host} - #{appointment.dog.name}" %>
              </h5>

              <!-- Category -->
              <% if appointment.appointment_type.present? %>
                <div class="mb-3">
                  <span class="badge bg-info">
                    <i class="fa-regular fa-calendar-check me-1"></i>
                    <%= appointment.appointment_type %>
                  </span>
                </div>
              <% end %>

              <!-- Date -->
              <div class="text-muted">
                <i class="fa-regular fa-calendar me-2"></i>
                <%= appointment.start_time.strftime("%b %d, %Y") %>
              </div>
              <div class="text-muted">
                <i class="fa-regular fa-clock me-2"></i>
                <%= appointment.start_time.strftime("%H:%M") %> - <%= appointment.end_time.strftime("%H:%M") %>
              </div>
            </div>
          </div>
        </div>
      <% end %>
    </div>
  <% else %>
    <div class="text-center py-5">
      <i class="fa-regular fa-calendar-xmark display-1 text-muted"></i>
      <h3 class="mt-3">No appointments yet</h3>
      <p class="text-muted">Get started by creating your first appointment</p>
      <%= link_to "Create Appointment", new_dog_appointment_path, class: "btn btn-primary mt-3" %>
    </div>
  <% end %>
</div>
